[#<StoreMovement id: 5573, product_id: 1116,
  quantity: 1,
  movement_type: "venta",
  order_id: nil,
  ticket_id: 140,
  store_id: 44,
  initial_price: 60.34,
  automatic_discount: 0.0,
  manual_discount: 0.0,
  discount_applied: 0.0,
  rule_could_be: nil,
  final_price: 60.34,
  tax_id: 2,
  taxes: 9.66,
  cost: 34.18,
  supplier_id: 2,
  product_request_id: nil,
  created_at: "2018-01-05 18:46:27",
  updated_at: "2018-01-05 18:46:27",
  total_cost: 34.18,
  discount_reason: nil,
  total: 69.99,
  subtotal: 60.34,
  bill_id: nil,
  pos: true,
  web: true,
  date: nil,
  prospect_id: nil,
  temporal: nil,
  down_applied: nil,
  pos_id: 2747,
  web_id: 5573>,

  #<StoreMovement id: 5572, product_id: 827,
  quantity: 4,
  movement_type: "venta",
  order_id: nil,
  ticket_id: 140,
  store_id: 44,
  initial_price: 12.93,
  automatic_discount: 0.0,
  manual_discount: 0.0,
  discount_applied: 0.0,
  rule_could_be: nil,
  final_price: 12.93,
  tax_id: 2,
  taxes: 8.28,
  cost: 7.29,
  supplier_id: 2,
  product_request_id: nil,
  created_at: "2018-01-05 18:46:27",
  updated_at: "2018-01-05 18:46:27",
  total_cost: 29.15,
  discount_reason: nil,
  total: 60.0,
  subtotal: 51.72,
  bill_id: nil,
  pos: true,
  web: true,
  date: nil,
  prospect_id: nil,
  temporal: nil,
  down_applied: nil,
  pos_id: 2746,
  web_id: 5572>,

  #<StoreMovement id: 5571, product_id: 442,
  quantity: 1,
  movement_type: "venta",
  order_id: nil,
  ticket_id: 140,
  store_id: 44,
  initial_price: 23.28,
  automatic_discount: 0.0,
  manual_discount: 0.0,
  discount_applied: 0.0,
  rule_could_be: nil,
  final_price: 23.28,
  tax_id: 2,
  taxes: 3.72,
  cost: 13.17,
  supplier_id: 2,
  product_request_id: nil,
  created_at: "2018-01-05 18:46:27",
  updated_at: "2018-01-05 18:46:27",
  total_cost: 13.17,
  discount_reason: nil,
  total: 27.0,
  subtotal: 23.28,
  bill_id: nil,
  pos: true,
  web: true,
  date: nil,
  prospect_id: nil,
  temporal: nil,
  down_applied: nil,
  pos_id: 2745,
  web_id: 5571>,
  #<StoreMovement id: 5570, product_id: 695,
  quantity: 2,
  movement_type: "venta",
  order_id: nil,
  ticket_id: 140,
  store_id: 44,
  initial_price: 6.9,
  automatic_discount: 0.0,
  manual_discount: 0.0,
  discount_applied: 0.0,
  rule_could_be: nil,
  final_price: 6.9,
  tax_id: 2,
  taxes: 2.21,
  cost: 3.64,
  supplier_id: 2,
  product_request_id: nil,
  created_at: "2018-01-05 18:46:27",
  updated_at: "2018-01-05 18:46:27",
  total_cost: 7.28,
  discount_reason: nil,
  total: 16.01,
  subtotal: 13.79,
  bill_id: nil,
  pos: true,
  web: true,
  date: nil,
  prospect_id: nil,
  temporal: nil, down_applied: nil, pos_id: 2744, web_id: 5570>,
  #<StoreMovement id: 5569, product_id: 475,
   quantity: 1, movement_type: "venta", order_id: nil, ticket_id: 140, store_id: 44, initial_price: 4.31, automatic_discount: 0.0, manual_discount: 0.0, discount_applied: 0.0, rule_could_be: nil, final_price: 4.31, tax_id: 2, taxes: 0.69, cost: 1.68, supplier_id: 2, product_request_id: nil, created_at: "2018-01-05 18:46:27", updated_at: "2018-01-05 18:46:27", total_cost: 1.68, discount_reason: nil, total: 5.0, subtotal: 4.31, bill_id: nil, pos: true, web: true, date: nil, prospect_id: nil, temporal: nil, down_applied: nil, pos_id: 2743, web_id: 5569>, #<StoreMovement id: 5568, product_id: 1040, quantity: 1, movement_type: "venta", order_id: nil, ticket_id: 140, store_id: 44, initial_price: 54.31, automatic_discount: 0.0, manual_discount: 0.0, discount_applied: 0.0, rule_could_be: nil, final_price: 54.31, tax_id: 2, taxes: 8.69, cost: 30.82, supplier_id: 2, product_request_id: nil, created_at: "2018-01-05 18:46:27", updated_at: "2018-01-05 18:46:27", total_cost: 30.82, discount_reason: nil, total: 63.0, subtotal: 54.31, bill_id: nil, pos: true, web: true, date: nil, prospect_id: nil, temporal: nil, down_applied: nil, pos_id: 2742, web_id: 5568>, #<StoreMovement id: 5567, product_id: 396, quantity: 1, movement_type: "venta", order_id: nil, ticket_id: 140, store_id: 44, initial_price: 33.19, automatic_discount: 0.0, manual_discount: 0.0, discount_applied: 0.0, rule_could_be: nil, final_price: 33.19, tax_id: 2, taxes: 5.31, cost: 18.77, supplier_id: 2, product_request_id: nil, created_at: "2018-01-05 18:46:27", updated_at: "2018-01-05 18:46:27", total_cost: 18.77, discount_reason: nil, total: 38.5, subtotal: 33.19, bill_id: nil, pos: true, web: true, date: nil, prospect_id: nil, temporal: nil, down_applied: nil, pos_id: 2741, web_id: 5567>, #<StoreMovement id: 5566, product_id: 479, quantity: 1, movement_type: "venta", order_id: nil, ticket_id: 140, store_id: 44, initial_price: 4.31, automatic_discount: 0.0, manual_discount: 0.0, discount_applied: 0.0, rule_could_be: nil, final_price: 4.31, tax_id: 2, taxes: 0.69, cost: 1.68, supplier_id: 2, product_request_id: nil, created_at: "2018-01-05 18:46:27", updated_at: "2018-01-05 18:46:27", total_cost: 1.68, discount_reason: nil, total: 5.0, subtotal: 4.31, bill_id: nil, pos: true, web: true, date: nil, prospect_id: nil, temporal: nil, down_applied: nil, pos_id: 2740, web_id: 5566>]


#<StoreSale id: 4, store_id: 44, month: "1", year: "2018", cost: 1452.58, created_at: "2018-01-05 16:24:25", updated_at: "2018-01-06 11:54:50", discount: 11.22, total: 2744.0, subtotal: 2376.83, taxes: 378.49, quantity: 188, payments: 2472.56, expenses: nil>

tickets.each do |ticket|

  ss = tickets.first.store.store_sales.first
  ticket.store_movements.each do |sm|
    ss.update(quantity: ss.quantity - sm.quantity, total: ss.total - sm.total, subtotal: ss.subtotal - sm.subtotal, taxes: ss.taxes - sm.taxes)
  end
  ticket.payments.each do |pay|
    ss.update(payments: ss.payments - pay.total)
  end
  ticket.update(store: nil)
end
